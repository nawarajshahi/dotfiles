#!/bin/bash

COLOR=$(tput setaf 7)
RST=$(tput sgr0)

if ! which --skip-functions upower &> /dev/null; then
  exit 0
fi

if [ "$(upower -e | grep -i bat | wc -l)" -gt 0 ]; then
  relevant_output="$(upower -i $(upower -e | grep -i bat) | grep --color=never -E "state|to\ full|to\ empty|percentage")"

  # We run slightly differently depending on whether this is intended for PS1
  # output or general CLI output
  if [ "$1" = "PS1" ]; then
    percentage="$(echo "${relevant_output}" | grep 'percentage' | awk '{ print $2 }')"
    state="$(echo "${relevant_output}" | grep 'state' | awk '{ print $2 }')"

    # Only show the percentage when we're discharging our battery
    if [ "${state}" = "discharging" ]; then
      echo "${COLOR}(${percentage})${RST} "
    fi
  else
    echo 'Current battery status:'
    echo "${relevant_output}" | awk '{$1=$1;print "\t", $0}'
  fi
fi
